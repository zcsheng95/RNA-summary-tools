---
title: "DCI Bioinformatics tools: Summary statistics used for QC automatic report"
author: "Zhecheng Sheng"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{DCI Bioinformatics tools: Summary statistics used for QC automatic report}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = FALSE,
  results = "asis",
  fig.show = "hold",
  fig.width = 10,
  fig.height = 5,
  fig.align = 'center'
)
```

This documentation demonstrates the utility tools included in this package for generating automatic QC reports. Generally it takes data from STAR output and Picard output. If you want to report any issues using that package, please contact [zhecheng.sheng@duke.edu](zhecheng.sheng@duke.edu).

## Introduction


This is the package consists of a number of utility functions developed and maintained by the Duke Cancer Institute (DCI) Bioinformatics Group to facilitate reproducible bioinformatics analyses. This package includes 5 sample folders, storing the output for STAR run and Picard run, be aware that your directory structure may be different from this 5 sample files. 


## Workflow Using Example Data
```{r setup}
library(dcibioinformatics)
```

 **Note**
 -  The STAR output should be stored in *rootdir/sample/star/* , as the newest pipeline stores the output this way.
 -  You can use `printab(table)` function in this package to present latex table in your report. 

### Tables output

* **Summary of STAR run**

```{r star summary, echo=TRUE}
rootdir <- dirname(system.file("extdata/samples","sample1/",package = "dcibioinformatics",mustWork = TRUE))
starsumm <- getSTARsum(rootdir = rootdir)
knitr::kable(starsumm[1:10,],align = 'c',caption = 'STAR Alignment Summary')
```

* **Summary of STAR Counts**

```{r star counts,echo = TRUE}
starcounts <- getSTARcounts(rootdir = rootdir, strand = "second")
knitr::kable(starcounts[1:10,],align = 'c',caption = 'STAR Counts Summary')
```

* **Summary of Picard Counts**
```{r picard counts, echo = TRUE}
picounts <- getPIcounts(rootdir = rootdir)
knitr::kable(picounts,align = 'c',caption = 'Picard Counts Summary')
```

### Costructing RNAqc class

```{r Create RNAqc class, echo = TRUE, eval=TRUE, results='markup'}
coldata <- data.frame(condition = c('A','A','A','B','B'),genotype = c('W','P','W','P','W'),row.names = paste0('sample',1:5))
### Create RNAqc instance
annodir <- dirname(system.file("extdata/","samples",package = "dcibioinformatics",mustWork = TRUE))
anno <- file.path(annodir, "annotation.txt")
rnaqc <- RNAqc(counts = starcounts, colData = coldata, picard = picounts,anno = anno)
show(rnaqc)
```

**Summary table for STAR mapping statistics**
```{r summary, eval =TRUE, echo = TRUE, results='markup'}
summary(rnaqc)
```


### Figures output

* **Counting Reads(STAR)**

```{r counting reads bar plot, echo=TRUE}
plot(rnaqc, textsize = 5)[[1]]
```

* **Counting Bases(Picard)**

```{r counting bases bar plot, echo = TRUE}
#### Without group
plot(rnaqc,textsize = 2)[[2]]
```

* **Unique Mapping rate**
```{r unique mapping rate, echo = TRUE}
plot(rnaqc, group = "condition")[[3]]
```

### Basic RNASeq Analsis

* **PCA plot**
```{r pca plot, echo = T, message=F}
createPCplot(rnaqc, var = "condition", label = TRUE)
```

* **Plot Size Factors**
```{r sizefactors ,echo = T, message=F}
plotSizefactor(rnaqc, group = "condition")
```


* **Check expression level for selected genes**

```{r visualize normlized counts for selected gene ,message=F,echo=T}
genelist = c("XWRnD","5hRk2","kfR6w","XGUbU")
checkExpression(rnaqc, group = "condition", genelist = genelist,gridvar = "genotype")
```

### To Be Continued...

### Reference

- !! Any external resources / Cite here


```{r echo = TRUE, results='markup'}
sessionInfo()
```